from argparse import ArgumentParser
from fdbk import Reporter

from piroommonitor import Sensors

parser = ArgumentParser()

parser.add_argument("db_parameters", nargs="+", type=str, help="Parameters for fdbk DB connection.")
parser.add_argument("--db-connection", type=str, default="ClientConnection", help="fdbk DB connection to use (default=ClientConnection)")
parser.add_argument("--interval", "-i", type=float, default=360.0, help="Data pushing interval in seconds.")
parser.add_argument("--num-samples", "-n", type=int, default=60, help="Number of samples to average during the push interval")
parser.add_argument("--verbose", "-v", action="store_true", help="Be more verbose.")
args = parser.parse_args()

print("Initializing")

sensors = Sensors()
reporter = Reporter(sensors, args.db_connection, args.db_parameters, interval=args.interval, num_samples=args.num_samples, verbose=args.verbose)

print("Start pushing data")

reporter.start()

print("Stop pushing data")

sensors.close()
